---
title: "F1"
author: "Katherine Savell"
date: "2023-05-02"
output: html_document
---

```{r}
library(renv)
renv::restore()
library(ggplot2)
library(reshape2)
library(ComplexHeatmap)
library(pheatmap)
```

```{r}
IDs <- data.frame(combined@assays[["RNA"]]@data@Dimnames[[2]])
IDs$cart <- combined@meta.data[["orig.ident"]]
IDs$rat <- combined@meta.data[["ratID"]]
IDs$st <- combined@meta.data[["Sample_tag"]]
IDs$st2 <- combined@meta.data[["ST2_reads"]]
IDs$st3 <- combined@meta.data[["ST3_reads"]]
IDs$st4 <- combined@meta.data[["ST4_reads"]]
IDs$st5 <- combined@meta.data[["ST5_reads"]]
IDs$st6 <- combined@meta.data[["ST6_reads"]]
IDs$st7 <- combined@meta.data[["ST7_reads"]]
IDs$st8 <- combined@meta.data[["ST8_reads"]]
IDs$st9 <- combined@meta.data[["ST9_reads"]]
rownames(IDs) <- IDs$combined.assays...RNA....data.Dimnames..2..
```


#Check sample tag reads for nuclei in rest of figures
```{r}
IDslist <- split(IDs, IDs$st)

#Make summary table of the medians of ST to determine heat map range
median <- sapply(IDslist, function(x) {
  # Find the names of the numeric columns
  numeric_cols <- sapply(x, is.numeric)
  
  # Ignore character columns
  numeric_cols <- numeric_cols & !sapply(x, is.character)
  
  # Find the medians of the numeric columns
  medians <- apply(x[, numeric_cols], 2, median)
  
  # Return a named vector of medians
  names(medians) <- names(x)[numeric_cols]
  return(medians)
})

mean <- sapply(IDslist, function(x) {
  # Find the names of the numeric columns
  numeric_cols <- sapply(x, is.numeric)
  
  # Ignore character columns
  numeric_cols <- numeric_cols & !sapply(x, is.character)
  
  # Find the medians of the numeric columns
  means <- apply(x[, numeric_cols], 2, mean)
  
  # Return a named vector of medians
  names(means) <- names(x)[numeric_cols]
  return(means)
})

write.csv(mean, '/Users/savellke/Output/stReadsMean06232023.csv')
write.csv(median, '/Users/savellke/Output/stReadsMedian06232023.csv')

pdf(file = "~/Output/C1ST.pdf",
    width = 10,
    height = 10)
draw(hm, heatmap_legend_side = "right")
dev.off()
```

#Create dataframe for pie chart values
```{r}
gaba.subset2$ratID_group <- paste(gaba.subset2$ratID,
                                  gaba.subset2$group,
                                  gaba.subset2$orig.ident,
                                  sep = "_")

df.gaba.rat_group <- data.frame(table(gaba.subset2$ratID_group))
df.gaba.group <- data.frame(table(gaba.subset2$group))

glut.subset2$ratID_group <- paste(glut.subset2$ratID,
                                  glut.subset2$group,
                                  glut.subset2$orig.ident,
                                  sep = "_")

df.glut.rat_group <- data.frame(table(glut.subset2$ratID_group))
df.glut.group <- data.frame(table(glut.subset2$group))
```


---
title: "F3"
author: "Kareem"
date: "2023-03-15"
output: html_document
---

#Load Packages
```{r}
library(Seurat)
library(ggplot2)
library(dplyr)
library(clustree)
library(tidyverse)
```
#Load Objects
```{r}
setwd("/Users/woodskad/Desktop/Analysis/F3/")
load("/Users/woodskad/Desktop/Analysis/S1/Robject/gaba_subset_forthpipe_03142023.RData")
load("/Users/woodskad/Desktop/Analysis/S1/Robject/glut_subset_forthpipe_11102022.RData")
```
#GLUT

#Make Glut Table 
```{r}
#glut table for cluster and group
glut.subset2$cluster_group <- paste(glut.subset2$seurat_clusters, 
                                    glut.subset2$group, 
                                    sep = "_")
df.glut1 <- data.frame(table(glut.subset2$cluster_group))
df.glut2 <- data.frame(table(glut.subset2$group))
df.glut1$group.total <- (df.glut2$Freq)
df.glut1$fract <- (df.glut1$Freq/df.glut1$group.total)
```

#glut table for RatID and group
```{r}
glut.subset2$ratID_group <- paste(glut.subset2$ratID, 
                                  glut.subset2$group, 
                                  sep = "_")
df.glut.group.ID <- data.frame(table(glut.subset2$ratID_group))
#Reorder df rows to input group total correctly
df.glut.ID.group <- df.glut.ID.group[c(3, 1, 2, 10, 4, 5, 11, 6, 7, 12, 8, 9),]
df.glut.ID.group$group.total <- (df.glut2$Freq)
df.glut.ID.group$fract <- (df.glut.ID.group$Freq/df.glut.ID.group$group.total)
```

#glut table for RatID and sex
```{r}
glut.subset2$ratID_sex <- paste(glut.subset2$ratID, 
                                  glut.subset2$sex, 
                                  sep = "_")
df.glut.ID.sex <- data.frame(table(glut.subset2$ratID_sex))
df.glut3 <- data.frame(table(glut.subset2$sex))
#Reorder rows to input sex total correctly
df.glut.ID.sex <- df.glut.ID.sex[c(1, 3, 2, 4, 5, 7, 6, 8),]
df.glut.ID.sex$sex.total <- (df.glut3$Freq)
df.glut.ID.sex$fract <- (df.glut.ID.sex$Freq/df.glut.ID.sex$sex.total)
```

#F3 Glut Fractions for cluster group and ratID
```{r}
glut.subset2$cluster_group_ratID <- paste(glut.subset2$seurat_clusters, 
                                    glut.subset2$ratID, glut.subset2$group,
                                    sep = "_")
glut.subset2$ratID_group <- paste(glut.subset2$ratID, 
                                  glut.subset2$group, 
                                  sep = "_")
#Regenerate the original data frame to check for errors
df.glut.CGI1 <- data.frame(table(glut.subset2$cluster_group_ratID))
df.glut.IG <- data.frame(table(glut.subset2$ratID_group))

#Separate Var1 into 3 or 2 columns
df.glut.CGI <- separate(df.glut.CGI1, 
                        col = Var1, into = c('cluster', 'ID', 'group'), 
                        sep = '_')

df.glut.IG <- separate(df.glut.IG, 
                       col = Var1, into = c('ID', 'group'), 
                       sep = '_')

#Merge data frames
df.glut.CGI <- merge.data.frame(df.glut.CGI, 
                                df.glut.IG, 
                                by.x = c("ID", "group"), 
                                by.y = c("ID", "group"), 
                                all = TRUE)
df.glut.CGI$Fract <- (df.glut.CGI$Freq.x/df.glut.CGI$Freq.y)
df.glut.CGI$Percent <- (df.glut.CGI$Fract * 100)
```

#GABA
#Make GABA Table 
```{r}
#Gaba table for cluster and group
gaba.subset2$cluster_group <- paste(gaba.subset2$seurat_clusters, 
                                    gaba.subset2$group, 
                                    sep = "_")

df.gaba1 <- data.frame(table(gaba.subset2$cluster_group))
df.gaba2 <- data.frame(table(gaba.subset2$group))
#add row to add group totals correctly 
df.gaba1[nrow(df.gaba1) +1,] <- list('6_positive', '0')
df.gaba1$group.total <- (df.gaba2$Freq)

#then delete after to find fractions
df.gaba1 <- df.gaba1[-21,]
#Change Freq from character to numeric values to divide by group total
df.gaba1$Freq <- as.numeric(df.gaba1$Freq)

df.gaba1$fract <- (df.gaba1$Freq/df.gaba1$group.total)
```

#GABA table for ratID and group
```{r}
gaba.subset2$ratID_group <- paste(gaba.subset2$ratID, 
                                    gaba.subset2$group, 
                                    sep = "_")
df.gaba.ID.group <- data.frame(table(gaba.subset2$ratID_group))

#Reorder rows to add group totals correctly
df.gaba.ID.group <- df.gaba.ID.group[c(3, 1, 2, 10, 4, 5, 11, 6, 7, 12, 8, 9),]
df.gaba.ID.group$group.total <- (df.gaba2$Freq)
df.gaba.ID.group$fract <- (df.gaba.ID.group$Freq/df.gaba.ID.group$group.total)

```

#GABA table for ratID and sex
```{r}
gaba.subset2$ratID_sex <- paste(gaba.subset2$ratID, 
                                    gaba.subset2$sex, 
                                    sep = "_")
df.gaba.ID.sex <- data.frame(table(gaba.subset2$ratID_sex))
df.gaba3 <- data.frame(table(gaba.subset2$sex))
#Reorder rows to input sex total correctly
df.gaba.ID.sex <- df.gaba.ID.sex[c(1, 3, 2, 4, 5, 7, 6, 8),]
df.gaba.ID.sex$sex.total <- (df.gaba3$Freq)
df.gaba.ID.sex$fract <- (df.gaba.ID.sex$Freq/df.gaba.ID.sex$sex.total)
```



#F3 GABA Fractions for cluster group and ratID
```{r}
gaba.subset2$cluster_group_ratID <- paste(gaba.subset2$seurat_clusters, 
                                    gaba.subset2$ratID, gaba.subset2$group,
                                    sep = "_")
gaba.subset2$ratID_group <- paste(gaba.subset2$ratID, 
                                  gaba.subset2$group, 
                                  sep = "_")
#Regenerate the original data frame to check for errors
df.gaba.CGI1 <- data.frame(table(gaba.subset2$cluster_group_ratID))
df.gaba.IG <- data.frame(table(gaba.subset2$ratID_group))

#Separate Var1 into 3 or 2 columns
df.gaba.CGI <- separate(df.gaba.CGI, 
                        col = Var1, into = c('cluster', 'ID', 'group'), 
                        sep = '_')

df.gaba.IG <- separate(df.gaba.IG, 
                       col = Var1, into = c('ID', 'group'), 
                       sep = '_')

#Merge data frames
df.gaba.CGI <- merge.data.frame(df.gaba.CGI, 
                                df.gaba.IG, 
                                by.x = c("ID", "group"), 
                                by.y = c("ID", "group"), 
                                all = TRUE)
df.gaba.CGI$Fract <- (df.gaba.CGI$Freq.x/df.gaba.CGI$Freq.y)
df.gaba.CGI$Percent <- (df.gaba.CGI$Fract * 100)
```

#Glut: Fraction/Percent totals for Rat in each cluster
```{r}
glut.subset2$cluster_ratID <- paste(glut.subset2$seurat_clusters,
                                   glut.subset2$ratID,
                                   glut.subset2$sex,
                                   glut.subset2$group,
                                   sep = "_")
glut.subset2$cluster <- paste(glut.subset2$seurat_clusters,
                              glut.subset2$group,
                              sep = "_")

df.glut.cluster.rat <- data.frame(table(glut.subset2$cluster_ratID))
df.glut.clusters <- data.frame(table(glut.subset2$cluster))

df.glut.cluster.rat <- separate(df.glut.cluster.rat, col = Var1, into = c("cluster", "rat", "sex", "group"), sep = "_")
df.glut.clusters <- separate(df.glut.clusters, col = Var1, into = c("cluster", "group"))

df.glut.cluster.rat <- merge.data.frame(df.glut.cluster.rat, 
                                  df.glut.clusters,
                                  by.x = c("cluster","group"), 
                                  by.y = c("cluster","group"),
                                  all = TRUE)
df.glut.cluster.rat$Fraction <- (df.glut.cluster.rat$Freq.x/df.glut.cluster.rat$Freq.y)
df.glut.cluster.rat$Percent <- (df.glut.cluster.rat$Fraction * 100)
```

#GABA: Fraction/Percent totals for Rat in each cluster
```{r}
gaba.subset2$cluster_ratID <- paste(gaba.subset2$seurat_clusters,
                                   gaba.subset2$ratID,
                                    gaba.subset2$sex,
                                   gaba.subset2$group,
                                   sep = "_")
gaba.subset2$cluster <- paste(gaba.subset2$seurat_clusters,
                              gaba.subset2$group,
                              sep = "_")

df.gaba.cluster.rat <- data.frame(table(gaba.subset2$cluster_ratID))
df.gaba.clusters <- data.frame(table(gaba.subset2$cluster))

df.gaba.cluster.rat <- separate(df.gaba.cluster.rat, col = Var1, into = c("cluster", "rat", "sex", "group"), sep = "_")
df.gaba.clusters <- separate(df.gaba.clusters, col = Var1, into = c("cluster", "group"))

df.gaba.cluster.rat <- merge.data.frame(df.gaba.cluster.rat, 
                                  df.gaba.clusters,
                                  by.x = c("cluster","group"), 
                                  by.y = c("cluster","group"),
                                  all = TRUE)
df.gaba.cluster.rat$Fraction <- (df.gaba.cluster.rat$Freq.x/df.gaba.cluster.rat$Freq.y)
df.gaba.cluster.rat$Percent <- (df.gaba.cluster.rat$Fraction * 100)
```

#Glut: Fraction/Percent totals for cluster in each rat
```{r}
glut.subset2$ratID_cluster_group_sex <- paste(glut.subset2$ratID,
                                  glut.subset2$seurat_clusters,
                                  glut.subset2$group,
                                  glut.subset2$sex,
                                  sep = "_")

glut.subset2$ratID.group <- paste(glut.subset2$ratID,
                              glut.subset2$group,
                              sep = "_")

df.glut.RCGS <- data.frame(table(glut.subset2$ratID_cluster_group_sex))
df.glut.ratID.group <- data.frame(table(glut.subset2$ratID.group))
df.glut.rat.total <- data.frame(table(glut.subset2$ratID))

df.glut.ratID.group <- df.glut.ratID.group[-c(1, 3, 4, 6, 8, 10, 11, 12),]

df.glut.RCGS <- separate(df.glut.RCGS, col = Var1, into = c("rat", "cluster", "group", "sex"), sep = "_")
df.glut.ratID.group <- separate(df.glut.ratID.group, col = Var1, into = c("rat", "group"))
colnames(df.glut.rat.total)[1] = "rat"

df.glut.RCGS <- merge.data.frame(df.glut.RCGS, 
                                  df.glut.rat.total,
                                  by.x = ("rat"), 
                                  by.y = ("rat"),
                                  all = TRUE)

df.glut.RCGS <- merge.data.frame(df.glut.RCGS, 
                                  df.glut.ratID.group,
                                  by.x = ("rat"), 
                                  by.y = ("rat"),
                                  all = TRUE)



df.glut.RCGS$NegOnly <- (df.glut.RCGS$Freq.y - df.glut.RCGS$Freq)
df.glut.RCGS$NegOnlyFract <- (df.glut.RCGS$Freq.x/df.glut.RCGS$NegOnly)


df.glut.RCGS$Fraction <- df.glut.RCGS$Freq.x/df.glut.RCGS$Freq.y





df.glut.RCGS$NegOnlyPer <- (df.glut.RCGS$NegOnlyFract * 100)                     
df.glut.RCGS$Percent <- (df.glut.RCGS$Fraction * 100)
```

#GABA: Fraction/Percent totals for cluster in each rat
```{r}
gaba.subset2$ratID_cluster_group_sex <- paste(gaba.subset2$ratID,
                                  gaba.subset2$seurat_clusters,
                                  gaba.subset2$group,
                                  gaba.subset2$sex,
                                  sep = "_")

gaba.subset2$ratID.group <- paste(gaba.subset2$ratID,
                              gaba.subset2$group,
                              sep = "_")

df.gaba.RCGS <- data.frame(table(gaba.subset2$ratID_cluster_group_sex))
df.gaba.ratID.group <- data.frame(table(gaba.subset2$ratID.group))
df.gaba.rat.total <- data.frame(table(gaba.subset2$ratID))

df.gaba.ratID.group <- df.gaba.ratID.group[-c(1, 3, 4, 6, 8, 10, 11, 12),]

df.gaba.RCGS <- separate(df.gaba.RCGS, col = Var1, into = c("rat", "cluster", "group", "sex"), sep = "_")
df.gaba.ratID.group <- separate(df.gaba.ratID.group, col = Var1, into = c("rat", "group"))
colnames(df.gaba.rat.total)[1] = "rat"

df.gaba.RCGS <- merge.data.frame(df.gaba.RCGS, 
                                  df.gaba.rat.total,
                                  by.x = ("rat"), 
                                  by.y = ("rat"),
                                  all = TRUE)

df.gaba.RCGS <- merge.data.frame(df.gaba.RCGS, 
                                  df.gaba.ratID.group,
                                  by.x = ("rat"), 
                                  by.y = ("rat"),
                                  all = TRUE)



df.gaba.RCGS$NegOnly <- (df.gaba.RCGS$Freq.y - df.gaba.RCGS$Freq)
df.gaba.RCGS$NegOnlyFract <- (df.gaba.RCGS$Freq.x/df.gaba.RCGS$NegOnly)


df.gaba.RCGS$Fraction <- df.gaba.RCGS$Freq.x/df.gaba.RCGS$Freq.y





df.gaba.RCGS$NegOnlyPer <- (df.gaba.RCGS$NegOnlyFract * 100)                     
df.gaba.RCGS$Percent <- (df.gaba.RCGS$Fraction * 100)
```

#Save tables as CSV files
```{r}
write_csv(df.gaba.RCGS, file = "/Users/woodskad/Library/CloudStorage/Box-Box/mRFP-snSeq/Project1_XPoSEseq/XPoSEseq_manuscript/F3_panels/Tables for F3 Panels/df.gaba.RCGS.csv")
write_csv(df.glut.RCGS, file = "/Users/woodskad/Library/CloudStorage/Box-Box/mRFP-snSeq/Project1_XPoSEseq/XPoSEseq_manuscript/F3_panels/Tables for F3 Panels/df.glut.RCGS.csv")

```
